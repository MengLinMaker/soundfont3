import{SoundFont3 as e}from"../soundFont3.js";import{writeSoundFont as t}from"./writeSoundFont.js";import{concatBuffer as r}from"./utils.js";function a(e){const t=new DataView(new ArrayBuffer(2*e.length));let r=0;for(let a=0;a<e.length;a++,r+=2){const n=Math.max(-1,Math.min(1,e[a]));t.setInt16(r,n<0?32768*n:32767*n,!0)}return t.buffer}const n=async n=>{const o=structuredClone(n);if(Number(o.metaData.version)<3)return n;const s=[];let d=new Int8Array,h=0;const i=await import("audio-decode");for(const e of o.samples){const t=a((await i.default(new Int8Array(e.data).buffer)).getChannelData(0)),n=new ArrayBuffer(2-t.byteLength%2);e.header.start=h,e.header.end=h+t.byteLength/2;const o=e.header.end-e.header.start,f=e.header.endLoop-e.header.startLoop;e.header.endLoop=o-128,e.header.startLoop=o-f-128,d=r(r(d,t),n),h+=t.byteLength/2+n.byteLength,s.push(e.header)}return console.info(`Sample size: ${(d.byteLength/10**6).toFixed(3)} mb`),o.metaData.version="2.04",o.sampleData=new Int16Array(d),o.presetData.sampleHeaders=s,new e(new Uint8Array(t(o)))};export{n as toSoundFont2Web};
//# sourceMappingURL=toSoundFont2Web.js.map
